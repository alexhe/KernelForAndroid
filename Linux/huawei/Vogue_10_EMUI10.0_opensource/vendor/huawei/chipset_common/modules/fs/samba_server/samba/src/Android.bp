cc_defaults {
    name: "samba_bins_defaults",
    local_include_dirs: [
        "popt",
        "iniparser/src",
        "include",
        "lib/replace",
        "lib/talloc",
        "tdb/include",
        "libaddns",
        "librpc",
        "lib",
        "utils",
    ],

    cflags: [
        "-D_SAMBA_BUILD_=3",
        "-DHAVE_CONFIG_H",
        "-DHUAWEI_CUSTOM_FUNCTION",
        "-DHUAWEI_CUSTOM_PERFORMANCE",
        "-pie",
        "-fPIE",
        "-Wno-comment",
        "-Wno-pointer-bool-conversion",
        "-Wno-int-conversion",
        "-Wno-tautological-pointer-compare",
        "-Wno-int-to-pointer-cast",
        "-Wno-unused-parameter",
        "-Wno-sign-compare",
        "-Wno-unused-const-variable",
        "-Wno-unused-variable",
        "-Wno-incompatible-pointer-types-discards-qualifiers",
        "-Wno-sizeof-array-argument",
        "-Wno-deprecated-declarations",
        "-Wno-format",
        "-Wno-missing-field-initializers",
        "-Wno-shift-negative-value",
        "-Wno-non-literal-null-conversion",
        "-Wno-incompatible-pointer-types",
        "-Wno-unused-value",
        "-Wno-unused-function",
        "-Wno-parentheses-equality",
        "-DBINDIR=\"/data/samba_server/bin\"",
        "-DSBINDIR=\"/data/samba_server/sbin\"",
        "-DROOTSBINDIR=\"/data/samba_server/sbin\"",
        "-DLIBDIR=\"/data/samba_server/lib\"",
        "-DPAMMODULESDIR=\"/data/samba_server/lib/security\"",
        "-DVFSLIBDIR=\"/data/samba_server/lib/vfs\"",
        "-DPDBLIBDIR=\"/data/samba_server/lib/pdb\"",
        "-DRPCLIBDIR=\"/data/samba_server/lib/rpc\"",
        "-DIDMAPLIBDIR=\"/data/samba_server/lib/idmap\"",
        "-DNSSINFOLIBDIR=\"/data/samba_server/lib/nss_info\"",
        "-DCHARSETLIBDIR=\"/data/samba_server/lib/charset\"",
        "-DCONFIGDIR=\"/data/samba_server/etc\"",
        "-DVARDIR=\"/data/samba_server/var\"",
        "-DMANDIR=\"\"",
        "-DDATADIR=\"/data/samba_server/share\"",
        "-DLOGFILEBASE=\"/data/samba_server/var\"",
        "-DCONFIGFILE=\"/data/samba_server/etc/smb.conf\"",
        "-DLMHOSTSFILE=\"/data/samba_server/etc/lmhosts\"",
        "-DPRIVATEDIR=\"/data/samba_server/private\"",
        "-DSMB_PASSWD_FILE=\"/data/samba_server/private/smbpasswd\"",
        "-DPRIVATE_DIR=\"/data/samba_server/private\"",
        "-DSWATDIR=\"/data/samba_server/swat\"",
        "-DLOCKDIR=\"/data/samba_server/var/locks\"",
        "-DPIDDIR=\"/data/samba_server/var/locks\"",
        "-DINSTALLPERMS=0755",
    ],
}


//generate smbd in /system/bin
// ======================================
cc_binary {
    name: "smbd",
    defaults: ["samba_bins_defaults"],
    shared_libs: [
        "libdl",
        "libc",
        "libcutils",
        "liblog",
    ],

    srcs: [
        "dynconfig.c",
        "param/loadparm.c",
        "param/params.c",
        "lib/sharesec.c",
        "lib/ldap_debug_handler.c",
        "smbd/open.c",
        "smbd/sec_ctx.c",
        "smbd/conn.c",
        "smbd/srvstr.c",
        "smbd/process.c",
        "smbd/uid.c",
        "smbd/mangle.c",
        "smbd/files.c",
        "smbd/statcache.c",
        "smbd/dir.c",
        "smbd/session.c",
        "lib/server_mutex.c",
        "smbd/negprot.c",
        "smbd/password.c",
        "smbd/connection.c",
        "smbd/service.c",
        "smbd/reply.c",
        "smbd/sesssetup.c",
        "smbd/trans2.c",
        "smbd/map_username.c",
        "smbd/dmapi.c",
        "smbd/nttrans.c",
        "smbd/close.c",
        "smbd/filename.c",
        "smbd/vfs.c",
        "smbd/fileio.c",
        "modules/vfs_default.c",
        "smbd/posix_acls.c",
        "lib/sysacls.c",
        "lib/sysquotas.c",
        "lib/sysquotas_linux.c",
        "lib/sysquotas_xfs.c",
        "smbd/error.c",
        "smbd/ntquotas.c",
        "smbd/statvfs.c",
        "smbd/dosmode.c",
        "smbd/fake_file.c",
        "smbd/aio.c",
        "smbd/dfree.c",
        "smbd/quotas.c",
        "smbd/msdfs.c",
        "smbd/utmp.c",
        "smbd/share_access.c",
        "smbd/ipc.c",
        "smbd/message.c",
        "smbd/blocking.c",
        "smbd/mangle_hash2.c",
        "smbd/pipes.c",
        "smbd/mangle_hash.c",
        "smbd/mangle_map.c",
        "printing/printfsp.c",
        "smbd/lanman.c",
        "smbd/chgpasswd.c",
        "rpc_parse/parse_misc.c",
        "rpc_parse/parse_prs.c",
        "libsmb/clientgen.c",
        "libsmb/errormap.c",
        "libsmb/nterr.c",
        "libsmb/clirap.c",
        "libsmb/credentials.c",
        "libsmb/clireadwrite.c",
        "libsmb/namecache.c",
        "libsmb/cliconnect.c",
        "libsmb/namequery.c",
        "libsmb/smbdes.c",
        "libsmb/ntlmssp.c",
        "libsmb/smbencrypt.c",
        "libsmb/ntlm_check.c",
        "libsmb/doserr.c",
        "rpc_parse/parse_sec.c",
        "libsmb/clispnego.c",
        "libsmb/asn1.c",
        "libsmb/ntlmssp_sign.c",
        "libsmb/clierror.c",
        "libsmb/ntlmssp_parse.c",
        "libsmb/nmblib.c",
        "libsmb/unexpected.c",
        "libsmb/clistr.c",
        "libsmb/clikrb5.c",
        "libsmb/conncache.c",
        "libsmb/clifile.c",
        "libsmb/clitrans.c",
        "libsmb/cliquota.c",
        "libsmb/clioplock.c",
        "libsmb/pwd_cache.c",
        "libads/dns.c",
        "libsmb/dcerpc_err.c",
        "libsmb/smberr.c",
        "libsmb/namequery_dc.c",
        "rpc_server/srv_svcctl.c",
        "rpc_server/srv_svcctl_nt.c",
        "services/svc_spoolss.c",
        "services/svc_rcinit.c",
        "services/services_db.c",
        "services/svc_netlogon.c",
        "services/svc_winreg.c",
        "services/svc_wins.c",
        "rpc_server/srv_pipe_hnd.c",
        "rpc_server/srv_pipe.c",
        "rpc_server/srv_lsa_hnd.c",
        "rpc_server/srv_srvsvc.c",
        "rpc_server/srv_srvsvc_nt.c",
        "rpc_server/srv_lsa.c",
        "rpc_server/srv_lsa_nt.c",
        "rpc_server/srv_netlog.c",
        "rpc_server/srv_netlog_nt.c",
        "rpc_server/srv_samr.c",
        "rpc_server/srv_samr_nt.c",
        "rpc_server/srv_samr_util.c",
        "rpc_server/srv_reg.c",
        "rpc_server/srv_reg_nt.c",
        "registry/regfio.c",
        "rpc_server/srv_lsa_ds.c",
        "rpc_server/srv_lsa_ds_nt.c",
        "rpc_server/srv_ntsvcs.c",
        "rpc_server/srv_ntsvcs_nt.c",
        "rpc_server/srv_dfs.c",
        "rpc_server/srv_dfs_nt.c",
        "rpc_server/srv_eventlog.c",
        "rpc_server/srv_eventlog_nt.c",
        "rpc_server/srv_eventlog_lib.c",
        "rpc_server/srv_echo.c",
        "rpc_server/srv_echo_nt.c",
        "librpc/gen_ndr/srv_wkssvc.c",
        "rpc_server/srv_wkssvc_nt.c",
        "rpc_parse/parse_lsa.c",
        "rpc_parse/parse_rpc.c",
        "rpc_parse/parse_net.c",
        "rpc_parse/parse_srv.c",
        "rpc_parse/parse_samr.c",
        "rpc_parse/parse_ds.c",
        "rpc_parse/parse_spoolss.c",
        "rpc_parse/parse_eventlog.c",
        "rpc_parse/parse_buffer.c",
        "rpc_parse/parse_ntsvcs.c",
        "rpc_parse/parse_svcctl.c",
        "registry/reg_objects.c",
        "rpc_parse/parse_dfs.c",
        "rpc_parse/parse_reg.c",
        "rpc_parse/parse_echo.c",
        "rpc_parse/parse_shutdown.c",
        "passdb/secrets.c",
        "passdb/machine_sid.c",
        "locking/locking.c",
        "locking/brlock.c",
        "locking/posix.c",
        "passdb/pdb_get_set.c",
        "passdb/lookup_sid.c",
        "passdb/pdb_interface.c",
        "passdb/passdb.c",
        "passdb/util_unixsids.c",
        "lib/util_nscd.c",
        "lib/account_pol.c",
        "passdb/pdb_compat.c",
        "passdb/pdb_tdb.c",
        "lib/privileges.c",
        "passdb/util_builtin.c",
        "passdb/util_wellknown.c",
        "passdb/pdb_smbpasswd.c",
        "lib/talloc/talloc.c",
        "lib/replace/snprintf.c",
        "lib/replace/replace.c",
        "lib/version.c",
        "lib/messages.c",
        "lib/charcnv.c",
        "lib/debug.c",
        "lib/fault.c",
        "lib/system.c",
        "lib/util.c",
        "lib/signal.c",
        "lib/module.c",
        "lib/pidfile.c",
        "lib/util_unistr.c",
        "lib/time.c",
        "lib/util_str.c",
        "lib/util_sec.c",
        "lib/util_sock.c",
        "lib/interface.c",
        "lib/events.c",
        "lib/substitute.c",
        "lib/genrand.c",
        "lib/select.c",
        "tdb/common/tdb.c",
        "tdb/common/open.c",
        "lib/util_tdb.c",
        "tdb/common/transaction.c",
        "lib/adt_tree.c",
        "lib/util_seaccess.c",
        "lib/secdesc.c",
        "lib/secace.c",
        "lib/data_blob.c",
        "lib/util_sid.c",
        "lib/smbrun.c",
        "nsswitch/wb_client.c",
        "lib/bitmap.c",
        "lib/username.c",
        "tdb/common/traverse.c",
        "tdb/common/lock.c",
        "lib/util_pw.c",
        "tdb/common/io.c",
        "libsmb/smb_signing.c",
        "lib/md5.c",
        "nsswitch/wb_common.c",
        "lib/secacl.c",
        "lib/util_file.c",
        "tdb/common/freelist.c",
        "lib/md4.c",
        "lib/interfaces.c",
        "lib/xfile.c",
        "lib/iconv.c",
        "tdb/common/error.c",
        "lib/gencache.c",
        "lib/tallocmsg.c",
        "lib/arc4.c",
        "lib/hmacmd5.c",
        "lib/dprintf.c",
        "lib/wins_srv.c",
        "lib/fsusage.c",
        "lib/access.c",
        "lib/sendfile.c",
        "intl/lang_tdb.c",
        "lib/dmallocmsg.c",
        "lib/clobber.c",
        "lib/ms_fnmatch.c",
        "lib/system_smbd.c",
        "lib/util_uuid.c",
        "lib/crc32.c",
        "lib/sock_exec.c",
        "lib/ufc.c",
        "smbd/oplock.c",
        "smbd/notify.c",
        "smbd/notify_inotify.c",
        "smbd/notify_internal.c",
        "groupdb/mapping.c",
        "groupdb/mapping_tdb.c",
        "auth/auth.c",
        "auth/auth_ntlmssp.c",
        "auth/auth_unix.c",
        "auth/auth_winbind.c",
        "auth/auth_sam.c",
        "auth/auth_util.c",
        "auth/auth_compat.c",
        "auth/auth_server.c",
        "auth/auth_builtin.c",
        "auth/pampass.c",
        "auth/pass_check.c",
        "librpc/ndr/ndr_basic.c",
        "librpc/ndr/ndr.c",
        "librpc/ndr/ndr_misc.c",
        "librpc/gen_ndr/ndr_notify.c",
        "librpc/gen_ndr/ndr_wkssvc.c",
        "librpc/ndr/ndr_string.c",
        "libads/ads_struct.c",
        "libads/ads_status.c",
        "registry/reg_frontend.c",
        "registry/reg_cachehook.c",
        "registry/reg_db.c",
        "registry/reg_eventlog.c",
        "registry/reg_util.c",
        "registry/reg_dynamic.c",
        "registry/reg_perfcount.c",
        "smbd/build_options.c",
        "smbd/server.c",
    ],

    compile_multilib: "first",
    clang: true,
    init_rc: ["samba.rc"],
}

//generate nmbd in /system/bin
// ======================================
cc_binary {
    name: "nmbd",
    defaults: ["samba_bins_defaults"],

    shared_libs: [
        "libdl",
        "libcutils",
        "liblog",
    ],

    srcs: [
        "smbd/build_options.c",
        "nmbd/asyncdns.c",
        "nmbd/nmbd.c",
        "nmbd/nmbd_become_dmb.c",
        "nmbd/nmbd_become_lmb.c",
        "nmbd/nmbd_browserdb.c",
        "nmbd/nmbd_browsesync.c",
        "nmbd/nmbd_elections.c",
        "nmbd/nmbd_incomingdgrams.c",
        "nmbd/nmbd_incomingrequests.c",
        "nmbd/nmbd_lmhosts.c",
        "nmbd/nmbd_logonnames.c",
        "nmbd/nmbd_mynames.c",
        "nmbd/nmbd_namelistdb.c",
        "nmbd/nmbd_namequery.c",
        "nmbd/nmbd_nameregister.c",
        "nmbd/nmbd_namerelease.c",
        "nmbd/nmbd_nodestatus.c",
        "nmbd/nmbd_packets.c",
        "nmbd/nmbd_processlogon.c",
        "nmbd/nmbd_responserecordsdb.c",
        "nmbd/nmbd_sendannounce.c",
        "nmbd/nmbd_serverlistdb.c",
        "nmbd/nmbd_subnetdb.c",
        "nmbd/nmbd_winsproxy.c",
        "nmbd/nmbd_winsserver.c",
        "nmbd/nmbd_workgroupdb.c",
        "nmbd/nmbd_synclists.c",
        "dynconfig.c",
        "param/loadparm.c",
        "param/params.c",
        "lib/sharesec.c",
        "lib/ldap_debug_handler.c",
        "lib/replace/snprintf.c",
        "lib/replace/replace.c",
        "lib/talloc/talloc.c",
        "lib/version.c",
        "lib/charcnv.c",
        "lib/debug.c",
        "lib/util.c",
        "lib/util_sid.c",
        "lib/util_file.c",
        "lib/util_uuid.c",
        "lib/util_str.c",
        "lib/fault.c",
        "lib/interface.c",
        "lib/gencache.c",
        "lib/xfile.c",
        "lib/genrand.c",
        "lib/system.c",
        "lib/data_blob.c",
        "lib/interfaces.c",
        "lib/dprintf.c",
        "lib/pidfile.c",
        "lib/crc32.c",
        "lib/hmacmd5.c",
        "lib/md5.c",
        "lib/util_sec.c",
        "lib/md4.c",
        "lib/dmallocmsg.c",
        "lib/ms_fnmatch.c",
        "lib/util_pw.c",
        "lib/smbrun.c",
        "libsmb/smb_signing.c",
        "lib/signal.c",
        "lib/tallocmsg.c",
        "lib/substitute.c",
        "lib/secace.c",
        "lib/username.c",
        "intl/lang_tdb.c",
        "lib/iconv.c",
        "lib/secacl.c",
        "lib/util_seaccess.c",
        "lib/secdesc.c",
        "lib/module.c",
        "lib/events.c",
        "lib/sock_exec.c",
        "lib/util_unistr.c",
        "lib/util_sock.c",
        "lib/time.c",
        "lib/wins_srv.c",
        "lib/messages.c",
        "lib/select.c",
        "lib/arc4.c",
        "lib/util_tdb.c",
        "tdb/common/tdb.c",
        "tdb/common/open.c",
        "tdb/common/traverse.c",
        "tdb/common/lock.c",
        "tdb/common/io.c",
        "tdb/common/transaction.c",
        "tdb/common/freelist.c",
        "tdb/common/error.c",
        "rpc_parse/parse_prs.c",
        "rpc_parse/parse_sec.c",
        "libsmb/nterr.c",
        "libsmb/smbdes.c",
        "libsmb/clifile.c",
        "libsmb/clientgen.c",
        "libsmb/cliconnect.c",
        "libsmb/clirap.c",
        "libsmb/clistr.c",
        "libsmb/clitrans.c",
        "libsmb/clierror.c",
        "libsmb/clioplock.c",
        "libsmb/clispnego.c",
        "libsmb/smberr.c",
        "libsmb/asn1.c",
        "libsmb/clikrb5.c",
        "libsmb/pwd_cache.c",
        "libsmb/smbencrypt.c",
        "libsmb/ntlmssp.c",
        "libsmb/ntlmssp_parse.c",
        "libsmb/ntlmssp_sign.c",
        "libsmb/nmblib.c",
        "libsmb/namequery.c",
        "libsmb/unexpected.c",
        "libads/dns.c",
        "libads/kerberos.c",
        "libads/ads_status.c",
        "rpc_parse/parse_misc.c",
        "libsmb/namecache.c",
        "libsmb/conncache.c",
        "libsmb/dcerpc_err.c",
        "libsmb/errormap.c",
        "libsmb/doserr.c",
        "lib/dummysmbd.c",
        "lib/dummyroot.c",
        "profile/profile.c",
        "passdb/secrets.c",
        "passdb/machine_sid.c",
    ],
    compile_multilib: "first",
    clang: true,
}

//generate smbpasswd in /system/bin
// ======================================
cc_binary {
    name: "smbpasswd",
    defaults: ["samba_bins_defaults"],

    shared_libs: [
    "libdl",
        "libcutils",
        "liblog",
    ],

    srcs: [
        "utils/smbpasswd.c",
        "lib/talloc_stack.c",
        "lib/talloc/talloc_smbpasswd.c",
        "utils/smbpasswd_proc.c",
        "utils/smbpw_charcnv.c",
        "utils/smbpw_iconv.c",
        "lib/replace/snprintf.c",
        "lib/md4.c",
        "libsmb/smbdes.c",
        "lib/arc4.c",
        "libsmb/errormap.c",
    ],
    compile_multilib: "first",
    clang: true,
}
